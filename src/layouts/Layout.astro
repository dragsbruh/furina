---
import Navbar from "../components/Navbar.astro";
import Umami from "../components/Umami.astro";
import "../styles/global.css";

import { type SEOProps, SEO } from "astro-seo";

type PartialProps = {
  title?: string;
  titleTemplate?: string;
  titleDefault?: string;
  charset?: string;
  description?: string;
  canonical?: URL | string;
  nofollow?: boolean;
  noindex?: boolean;
  languageAlternates?: { href?: URL | string; hrefLang?: string }[];
  openGraph?: {
    basic?: {
      title?: string;
      type?: string;
      image?: string;
      url?: URL | string;
    };
    optional?: {
      audio?: string;
      description?: string;
      determiner?: string;
      locale?: string;
      localeAlternate?: string[];
      siteName?: string;
      video?: string;
    };
    image?: {
      url?: URL | string;
      secureUrl?: URL | string;
      type?: string;
      width?: number;
      height?: number;
      alt?: string;
    };
    article?: {
      publishedTime?: string;
      modifiedTime?: string;
      expirationTime?: string;
      authors?: string[];
      section?: string;
      tags?: string[];
    };
  };
  twitter?: {
    card?: string;
    site?: string;
    creator?: string;
    title?: string;
    description?: string;
    image?: URL | string;
    imageAlt?: string;
  };
  extend?: {
    link?: { rel?: string; href?: string; type?: string }[];
    meta?: { name?: string; content?: string }[];
  };
  surpressWarnings?: boolean;
};

export interface Props {
  seo?: PartialProps;
}

const defaultSeo: SEOProps = {
  title: "hai :3 i'm furina (dragsbruh)",
  charset: "utf-8",
  description:
    "i code and stuff and probably write stuff, heres some keywords for google: code, dev, programming, github.",
  openGraph: {
    basic: {
      title: "hai :3 i'm furina (dragsbruh)",
      image: `https://${Astro.site!.hostname}/avatar.png`,
      type: "profile",
    },
  },
  twitter: {
    title: "hai :3 i'm furina (dragsbruh)",
    site: "furina.is-a.dev",
    creator: "legendragswt",
    description:
      "i code and stuff and probably write stuff, heres some keywords for google: code, dev, programming, github.",
    card: "summary_large_image",
    image: `https://${Astro.site!.hostname}/avatar.png`,
    imageAlt: "furina de fontaine!!!",
  },
};

function deepMerge(target: SEOProps, source?: PartialProps): SEOProps {
  if (!source) return target;

  const result: any = { ...target };

  for (const key in source) {
    const sourceValue = source[key as keyof PartialProps];
    const targetValue = target[key as keyof SEOProps] ?? {};

    if (
      sourceValue &&
      typeof sourceValue === "object" &&
      !Array.isArray(sourceValue)
    ) {
      result[key] = deepMerge(targetValue as any, sourceValue as any);
    } else if (sourceValue !== undefined) {
      result[key] = sourceValue;
    }
  }

  return result;
}

const seo: SEOProps = deepMerge(defaultSeo, Astro.props.seo ?? {});
---

<html lang="en">
  <head>
    <link rel="icon" type="image/svg+xml" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <link rel="sitemap" href="/sitemap-index.xml" />
    <Umami />

    <SEO {...seo} />
  </head>
  <body>
    <div class="w-full h-full flex justify-center">
      <div class="w-full xl:w-3/4 max-w-[1080px] flex flex-col">
        <Navbar />
        <div class="px-10">
          <slot />
        </div>
      </div>
    </div>
  </body>
</html>
